import{AudioProcessor as e}from"./audioProcessor.js";let processor=new e(2e3,250,4e3,!1),toggleRecordButton=document.querySelector("#toggleRecord"),toggleResetButton=document.querySelector("#btnReset"),toggleResetNoiseButton=document.querySelector("#btnResetNoise"),statusRMS=document.querySelector("#statusRMS"),statusSNR=document.querySelector("#statusSNR"),statusQuality=document.querySelector("#quality"),statusAdvice=document.querySelector("#adviece"),recording=!1,RECORD="Record",STOP="Stop";function generateAudioAdvice(e,t){let o="",s=0;return e>=18?(o+="Audio is excellent, ",s=5):e>=15?(o+="Audio is good, ",s=4):e>=10?(o+="Audio is acceptable, ",s=3):e>=5?(o+="Audio is not ideal. Record in a quieter environment, ",s=2):(o+="Audio is poor; your speech may not be processed correctly, ",s=1),console.log("RMS: ",t),t>120?(o+="Sound is too loud and may cause noise.",s>1&&s--):t<6?(o+="Adjust the microphone distance.",s>1&&s--):o+="Mic distance seems appropriate.",{message:o.trim(),micQuality:s}}toggleRecordButton.addEventListener("click",async()=>{if(recording=!recording){toggleRecordButton.innerHTML="Stop";try{await processor.start(),console.log("Start processing...")}catch(e){console.error("An error in start processing: ",e),statusRMS.innerHTML=`Error: ${e.message}`}}else toggleRecordButton.innerHTML=RECORD,statusRMS.innerHTML="Click on Record button and wait for processing noise...",statusSNR.innerHTML="...",processor.stop()}),toggleResetButton.addEventListener("click",()=>{processor.resetMeasurements(),recording=!1,processor.stop(),toggleRecordButton.innerHTML=RECORD,statusRMS.innerHTML="Click on Record button and wait...",statusSNR.innerHTML="..."}),toggleResetNoiseButton.addEventListener("click",()=>{processor.resetMeasurements(),console.log("Noise and signals are resets...")}),processor.addEventListener("update",e=>{let{rmsSignal:t,rmsNoise:o,snr:s,noiseMode:r,timestamp:n}=e.detail,{message:i,micQuality:a}=generateAudioAdvice(s,t);r?(statusRMS.innerHTML=`Messuring noise<br/>RMS Noise: ${o}`,statusSNR.innerHTML="SNR: --"):(statusRMS.innerHTML=`RMS Signal: ${t}`,statusSNR.innerHTML=`SNR: ${s} dB`,statusAdvice.innerHTML=i,statusQuality.innerHTML=`${a}/5`),console.log("بروزرسانی در",new Date(n).toLocaleTimeString(),e.detail)});
